'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.errorMiddleware = errorMiddleware;

var _log = require('../log');

var _log2 = _interopRequireDefault(_log);

var _prettyError = require('pretty-error');

var _prettyError2 = _interopRequireDefault(_prettyError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Error middleware.
 * @return {Function}
 */
function errorMiddleware() {
  return function (err, req, res, next) {
    var status = err.status || err.code || 500;
    var message = err.message || '';
    var result = {
      status: status,
      message: message
    };
    if (err.errors) {
      result.errors = err.errors;
    }
    var renderedError = new _prettyError2.default().render(err);
    var serializedError = JSON.stringify(result, 2, 2);
    _log2.default.error(false, '' + renderedError + serializedError);
    res.status(status).json(result);
  };
}