#!/usr/bin/env node
'use strict';

var _path = require('path');

var _fs = require('fs');

var _log = require('../log');

var _log2 = _interopRequireDefault(_log);

var _minimist = require('minimist');

var _minimist2 = _interopRequireDefault(_minimist);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var argv = (0, _minimist2.default)(process.argv.slice(2), {
  alias: {
    h: 'help'
  },
  boolean: ['h']
});

if (argv.help) {
  console.log('\n    Description\n      Scaffolds a simple project structure to get started quickly.\n    Usage\n      $ magnet generate\n    Options\n      --help, -h      Displays this message\n  ');
  process.exit(0);
}

var dir = (0, _path.resolve)(argv._[0] || '.');

var basePackage = '{\n  "name": "my-app",\n  "engines": {\n    "node": ">=7.6.0"\n  },\n  "dependencies": {\n    "magnet": "latest"\n  },\n  "scripts": {\n    "dev": "magnet",\n    "start": "magnet build && magnet start"\n  }\n}';

var baseApi = 'export const route = {\n  method: \'get\',\n  path: \'/api\',\n  type: \'json\',\n};\n\nexport default async (req) => {\n  return {hello: \'Magnet\'};\n};\n';

var baseMagnetConfig = 'module.exports = {\n  magnet: {\n    port: 3000,\n  },\n};\n';

var baseIndex = 'export const route = {\n  method: \'get\',\n  path: \'/\',\n  type: \'html\',\n};\n\nexport default () => `<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <title>Magnet</title>\n</head>\n<body>\n  <h1>It works!</h1>\n  <a href="/api">http://localhost:3000/api</a>\n</body>\n</html>`;\n';

_log2.default.info(false, 'Generating files');

if (!(0, _fs.existsSync)(dir)) {
  (0, _fs.mkdirSync)(dir);
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'package.json'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'package.json'), basePackage.replace(/my-app/g, (0, _path.basename)(dir)));
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'static'))) {
  (0, _fs.mkdirSync)((0, _path.join)(dir, 'static'));
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'index.js'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'index.js'), baseIndex);
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'api.js'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'api.js'), baseApi);
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'magnet.config.js'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'magnet.config.js'), baseMagnetConfig);
}

_log2.default.info(false, 'Done.');